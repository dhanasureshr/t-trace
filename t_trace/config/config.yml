# M-TRACE Configuration - Aligned with Specification Section 3.1
# File: config.yml (default location: project root)

# ===== CORE LOGGING BEHAVIOR =====
mode: "development"  # Options: "development" (detailed) or "production" (lightweight)
logging:
  log_level: "detailed"  # Options: "minimal", "detailed", "debug"
  log_type: "attention"  # Options: "attention", "embedding", "prediction", "all"

# ===== SPARSE LOGGING (Section 3.1.4) =====
sparse_logging:
  enabled: true
  sparse_threshold: 0.1        # Log only values with abs(value) > threshold
  top_k_values: 5              # Always log top-k values even if below threshold
  quantization:
    enabled: false             # Optional lossy quantization (separate from compression)
    precision: "8-bit"         # Options: "8-bit", "16-bit"
    scale: 0.1

# ===== COMPRESSION (Section 3.1.3) =====
compression:
  enabled: true
  compression_type: "snappy"   # Options: "snappy", "zstd", "gzip", "none"
  compression_level: 1         # 1=fastest, 9=max compression (ignored for snappy)

# ===== LOGGING FREQUENCY (Section 3.1.5) =====
logging_frequency:
  batch_size: 10             # Write to storage after N logs collected
  time_interval: 10            # Max seconds between writes (even if batch not full)

# ===== MODULAR FIELD SELECTION (Section 3.1.7) =====
# Default fields (always logged for basic transparency):
default_fields:
  - model_type
  - framework
  - timestamp
  - run_id
  - mode
  - layer_name
  - losses

# Custom fields (logged only if explicitly enabled):
custom_fields:
  # Internal States
  - attention_weights
  - feature_maps
  - gradients
  - feature_importance
  - decision_paths
  
  # Contextual Information (debugging only - disable in production)
  #- input_data
  #- output_data
  
  # Intermediate Outputs
  - layer_activations
  - attention_distributions
  
  # Error Analysis (development mode only)
  - per_class_metrics
  - confusion_matrix
  - error_cases
  
  # Uncertainty & Sensitivity
  - uncertainty_estimates
  
  # Training Dynamics (training only)
  - learning_rate_schedules
  - gradient_norms
  - weight_updates
  
  # Data Quality Metrics
  - class_imbalance
  - missing_values
  - data_drift
  
  # Modality-Specific (for multimodal models)
  - text_attention_weights
  - text_embeddings
  - image_feature_maps
  - image_spatial_attention
  - audio_spectrogram_features
  - audio_temporal_attention
  
  # Graph Structures (for GNNs)
  - node_features
  - edge_features
  - adjacency_matrix
  - node_embeddings
  - graph_predictions

# ===== STORAGE ENGINE (Section 3.2) =====
storage:
  backend: "local"             # Options: "local", "s3", "hdfs"
  directory: "mtrace_logs"     # Local path or S3 bucket prefix
  format: "parquet"            # Storage format (Parquet required for schema support)
  
  # Security (cloud backends only)
  encryption:
    enabled: false             # Enable for S3/HDFS
    algorithm: "AES-256"
  rbac:
    enabled: false             # Role-based access control

# ===== ERROR HANDLING (Section 3.1.6) =====
error_handling:
  max_storage_retries: 3       # Max attempts before dropping logs
  emergency_recovery: true     # Save failed logs to JSON on critical errors
  fallback_to_minimal: true    # Drop custom fields if storage fails

# ===== FEEDBACK LOOP =====
feedback_loop:
  enabled: true
  error_analysis:
    loss_threshold: 0.1
    gradient_norm_threshold: 0.01
  refinement_suggestions: true

# ===== MULTIMODAL CONFIGURATION =====
multimodal:
  enabled: true
  modalities:
    - "text"
    - "image"
    - "audio"
  cross_modal_interactions:
    enabled: true
    fusion_method: "attention"